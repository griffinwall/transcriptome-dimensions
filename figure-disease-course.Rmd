---
title: "Figures of clinical risk models"
output:
  html_document:
    theme: united
    highlight: tango
---

```{r load_packages, message=F}
# Install and load required R packages
library("dplyr")
library("data.table")
library("ggplot2")
library("survminer")
library("survival")
```

Load model results
```{r}
load(file = "rdata/mod.disease-course.rdata")
```

Plotting setup
```{r}
theme_set(theme_minimal() + 
            theme(legend.position="none",
                  axis.title=element_text(size=8),
                  axis.text=element_text(size=7)))
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

Overall Survival (OS)
```{r}
md = os
pdt = data.frame(tme = md$data$ttcos, evt = md$data$censos, predictors = md$coxph$linear.predictors)
pdt$trt = cut(pdt$predictors,quantile(pdt$predictors,c(0,1/3,2/3,1)),include.lowest = T) #tertiles

ggsurvplot(survfit(Surv(time = pdt$tme, event = pdt$evt) ~ trt, data=pdt),palette=cbPalette[c(6,1,7)])
```

Time to first line treatment failure (TTF)
```{r}
md = tf
pdt = data.frame(tme = md$data$ttctf1, evt = md$data$censtf1, predictors = md$coxph$linear.predictors)
pdt$trt = cut(pdt$predictors,quantile(pdt$predictors,c(0,1/3,2/3,1)),include.lowest = T) #tertiles

ggsurvplot(survfit(Surv(time = pdt$tme, event = pdt$evt) ~ trt, data=pdt),palette=cbPalette[c(6,1,7)])
```